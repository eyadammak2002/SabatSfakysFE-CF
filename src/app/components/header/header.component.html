<header class="header">
  <div class="header-container">
    <!-- Logo -->
    <div class="logo">
      <a routerLink="/accueil">
        <img src="assets/logo.png" alt="SabatSfakys Logo" class="logo-img">
      </a>
    </div>
    

    <!-- Barre de recherche intelligente -->
    <div class="search-input-container">
      <input 
        type="text" 
        [(ngModel)]="searchQuery" 
        (input)="onSearchInput($event)"
        placeholder="Que recherchez-vous ? (ex: chaussures noires pour homme)" 
        class="intelligent-search-input">
      
      <div class="search-buttons">
        <button (click)="performStandardSearch()" class="search-btn" [disabled]="isLoading">
          <i class="fa fa-search"></i>
        </button>
      </div>
      
      <div *ngIf="isLoading" class="loading-indicator">
        <i class="fa fa-spinner fa-spin"></i>
      </div>
    </div>

    <!-- Icônes de navigation -->
    <div class="icon-links">
      <a *ngIf="isLoading" routerLink="/favoris" class="icon-link" title="Mes favoris">
        <i class="far fa-heart"></i>
      </a>
      <a routerLink="/panier" class="icon-link" title="Mon panier">
        <i class="fas fa-shopping-cart"></i>
      </a>
      
      <!-- Icône de profil avec dropdown -->
      <div class="dropdown">
        <a routerLink="/profil" class="icon-link profile-icon updateProfileIcon" title="Mon profil">
          <i class="fas fa-user"></i>
        </a>
        <div class="dropdown-menu" *ngIf="!isLoggedIn">
          <a routerLink="/auth/client/login">
            <i class="fas fa-user menu-icon"></i> Espace Client
          </a>
          <a routerLink="/auth/fournisseur/login">
            <i class="fas fa-store menu-icon"></i> Espace Boutique
          </a>
        </div>
      </div>

     
            <!-- Icône de notification avec compteur de notifications non lues -->
      <div *ngIf="isLoading" class="notification-icon" (click)="toggleNotifications($event)">
        <i class="fas fa-bell"></i>
        <span class="notification-badge" *ngIf="unreadNotifications.length > 0">
          {{ unreadNotifications.length }}
        </span>
      </div>

      <!-- Dropdown des notifications -->
      <div class="notification-dropdown" [class.show]="isNotificationDropdownOpen">
        <div class="notification-header">
          <h3>Notifications</h3>
          <button class="clear-btn" (click)="clearNotifications()" *ngIf="unreadNotifications.length > 0 || readNotifications.length > 0">
            <i class="fas fa-trash"></i>
          </button>
        </div>

        <!-- Section des notifications non lues -->
        <div class="notification-section" *ngIf="unreadNotifications.length > 0" >
          <h4 class="section-title">Nouvelles ({{ unreadNotifications.length }})</h4>
          <div class="notification-list">
            <div class="notification-item unread" *ngFor="let notification of unreadNotifications" onclick="getCommandeById">
              <div class="notification-content">
                <div class="notification-message">{{ notification.message }}</div>
                <div class="notification-time">{{ notification.createdAt | date:'short' }}</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Section des notifications lues -->
        <div class="notification-section" *ngIf="readNotifications.length > 0">
          <h4 class="section-title">Lues ({{ readNotifications.length }})</h4>
          <div class="notification-list">
            <div class="notification-item read" *ngFor="let notification of readNotifications">
              <div class="notification-content">
                <div class="notification-message">{{ notification.message }}</div>
                <div class="notification-time">{{ notification.createdAt | date:'short' }}</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Message s'il n'y a pas de notifications -->
        <div class="no-notifications" *ngIf="unreadNotifications.length === 0 && readNotifications.length === 0">
          <p>Vous n'avez pas de notifications</p>
        </div>
      </div>





    </div>

    <!-- Dropdown Espace Fournisseur -->
    <div ngbDropdown class="dropdown" *ngIf="showFournisseurDashboard">
      <a routerLink="/fournisseur" ngbDropdownToggle class="nav-link d-flex align-items-center">
        <i class="fas fa-store store-icon"></i>
        <span class="text-bold">Espace Fournisseur</span>
      </a>

      <div ngbDropdownMenu class="dropdown-menu custom-dropdown-menu">
        <a (click)="redirectToClient()" ngbDropdownItem>
          <i class="fas fa-user menu-icon"></i>Navigate to Espace Client
        </a>
        <a (click)="redirectToProfileFR()" ngbDropdownItem>
          <i class="fas fa-id-card menu-icon"></i> Profil
        </a><!--
        <a (click)="redirectToCreateArticle()" ngbDropdownItem>
          <i class="fas fa-plus-circle menu-icon"></i> Déposer Article
        </a>-->
 
        <a routerLink="/fournisseur/notifications" ngbDropdownItem>
          <i class="fas fa-bell menu-icon"></i> Notifications
        </a>
        
        <!-- Profil en bas du menu -->
        <div class="dropdown-profile">
          <span class="profile-name">{{ username }}</span><br><br>
          <span class="profile-name">{{ email }}</span>
        </div>

        <!-- LogOut avec icône -->
        <a href="javascript:void(0);" *ngIf="isLoggedIn" (click)="logout()" class="logout-link">
          <i class="fas fa-sign-out-alt"></i> Déconnexion
        </a>
      </div>
    </div>

    <!-- Dropdown Espace Client -->
    <div ngbDropdown class="dropdown" *ngIf="showClientDashboard">
      <a routerLink="/client" ngbDropdownToggle class="nav-link d-flex align-items-center">
        <i class="fas fa-user store-icon"></i>
        <span class="text-bold">Espace Client</span>
      </a>

      <div ngbDropdownMenu class="dropdown-menu custom-dropdown-menu">
        <a *ngIf="role === 'ROLE_CLIENT' && role2 === 'ROLE_FOURNISSEUR'" (click)="redirectToFR()" ngbDropdownItem>
          <i class="fas fa-store menu-icon"></i> Revenir à l'Espace Fournisseur
        </a>
        <a ngbDropdownItem routerLink="/panier">
          <i class="fas fa-shopping-cart menu-icon"></i> Mon Panier
        </a>
        <a ngbDropdownItem routerLink="/favoris">
          <i class="far fa-heart menu-icon"></i> Mes Favoris
        </a>
        <a (click)="redirectToProfile()" ngbDropdownItem>
          <i class="fas fa-id-card menu-icon"></i> Mon Profil
        </a>
        <a (click)="redirectToCommande()" ngbDropdownItem>
          <i class="fas fa-clipboard-list menu-icon"></i> Ma Commande
        </a>
        <a (click)="redirectToListReclamation()" ngbDropdownItem>
          <i class="fas fa-exclamation-circle menu-icon"></i> Mes Réclamations
        </a>
        <a (click)="redirectToListCommande()" ngbDropdownItem>
          <i class="fas fa-history menu-icon"></i> Historique Commandes
        </a>
        
        <!-- Profil dans le menu -->
        <div class="dropdown-profile">
          <span class="profile-name">{{ username }}</span><br><br>
          <span class="profile-name">{{ email }}</span>
        </div>
        
        <!-- Bouton déconnexion -->
        <a href="javascript:void(0);" *ngIf="isLoggedIn" (click)="logout()" class="logout-link">
          <i class="fas fa-sign-out-alt"></i> Déconnexion
        </a>
      </div>
    </div>
  </div>

  <!-- Dropdown des notifications -->
  <div class="notification-dropdown" [class.show]="isNotificationDropdownOpen">
    <div class="notification-header">
      <h3>Notifications</h3>
      <button class="clear-btn" (click)="clearNotifications()" *ngIf="unreadNotifications.length > 0 || readNotifications.length > 0">
        <i class="fas fa-trash"></i>
      </button>
    </div>
    
    <div class="notification-section" *ngIf="unreadNotifications.length > 0" >
      <h4 class="section-title">Nouvelles ({{ unreadNotifications.length }})</h4>
      <div class="notification-list">
        <div class="notification-item unread" *ngFor="let notification of unreadNotifications" onclick="getCommandeById">
          <div class="notification-content">
            <div class="notification-message">{{ notification.message }}</div>
            <div class="notification-time">{{ notification.createdAt | date:'short' }}</div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Section des notifications lues -->
    <div class="notification-section" *ngIf="readNotifications.length > 0">
      <h4 class="section-title">Lues ({{ readNotifications.length }})</h4>
      <div class="notification-list">
        <div class="notification-item read" *ngFor="let notification of readNotifications">
          <div class="notification-content">
            <div class="notification-message">{{ notification.message }}</div>
            <div class="notification-time">{{ notification.createdAt | date:'short' }}</div>
          </div>
        </div>
      </div>
    </div>
    
    
    <!-- Message s'il n'y a pas de notifications -->
    <div class="no-notifications" *ngIf="unreadNotifications.length === 0 && readNotifications.length === 0">
      <p>Vous n'avez pas de notifications</p>
    </div>
  </div>

  <!-- Menu de navigation principal -->
  <nav *ngIf="!showFournisseurDashboard" class="nav-links" style="background-color: rgba(165, 147, 130, 0.22);height: 50px;">
    <div ngbDropdown class="dropdown">
      <a  href="#" (click)="filterByCategory('chaussures', $event)" ngbDropdownToggle>
         Chaussures Classiques
      </a>
      <div ngbDropdownMenu class="dropdown-menu">
        <a href="#" (click)="filterByCategoryAndGenre('chaussures', 'FEMME', $event)" ngbDropdownItem>
         FEMME
        </a>
        <a href="#" (click)="filterByCategoryAndGenre('chaussures', 'HOMME', $event)" ngbDropdownItem>
           HOMME
        </a>
        <a href="#" (click)="filterByCategoryAndGenre('chaussures', 'ENFANT', $event)" ngbDropdownItem>
         ENFANT
        </a>
      </div>
    </div>

    <div ngbDropdown class="dropdown">
      <a  href="#" (click)="filterByCategory('botte', $event)" ngbDropdownToggle>
        Bottes
      </a>
      <div ngbDropdownMenu class="dropdown-menu">
        <a href="#" (click)="filterByCategoryAndGenre('botte', 'FEMME', $event)" ngbDropdownItem>
         FEMME
        </a>
        <a href="#" (click)="filterByCategoryAndGenre('botte', 'HOMME', $event)" ngbDropdownItem>
          HOMME
        </a>
        <a href="#" (click)="filterByCategoryAndGenre('botte', 'ENFANT', $event)" ngbDropdownItem>
        ENFANT
        </a>
      </div>
    </div>

    <div ngbDropdown class="dropdown" display="dynamic" placement="bottom">
      <a   href="#" (click)="filterByCategory('mocassins', $event)" ngbDropdownToggle>
       Mocassins
      </a>
      <div ngbDropdownMenu class="dropdown-menu">
        <a href="#" (click)="filterByCategoryAndGenre('mocassins', 'FEMME', $event)" ngbDropdownItem>
          FEMME
        </a>
        <a href="#" (click)="filterByCategoryAndGenre('mocassins', 'HOMME', $event)" ngbDropdownItem>
          HOMME
        </a>
        <a href="#" (click)="filterByCategoryAndGenre('mocassins', 'ENFANT', $event)" ngbDropdownItem>
          ENFANT
        </a>
      </div>
    </div>

    <div *ngIf="isLoggedIn" ngbDropdown class="dropdown" display="dynamic" placement="bottom">
      <a routerLink="/personnaliser" ngbDropdownToggle>
       Chaussures Personnalisées
      </a>
      <div ngbDropdownMenu class="dropdown-menu">
        <a class="dropdown-item" routerLink="/createArticlePersonaliser">
        Commander personnalisée
        </a>
        <a class="dropdown-item" routerLink="/articlePersonaliser">
        Mes commandes personnalisées
        </a>
      </div>
    </div>
  </nav>
</header>
 